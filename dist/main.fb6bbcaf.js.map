{"version":3,"sources":["js/view.js","js/model.js","js/utils.js","js/game.js","js/main.js"],"names":["COUNTER_NEG","cNEG","COUNTER_SRC","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","FACE_BASE","FACE_LOST","FACE_WON","View","model","globalOptions","tileSize","calculateTileSize","playground","document","getElementById","face","controls","style","setProperty","cols","rows","firstChild","removeChild","setNumber","Counters","MINES","mineCount","initViewListeners","listeners","onPlaygroundClick","bind","onPlaygroundRightClick","onResize","addEventListener","window","event","resize","preventDefault","dispatch","locateClickFromEvent","eventName","detail","CustomEvent","dispatchEvent","box","getBoundingClientRect","translationX","clientX","left","translationY","clientY","top","row","Math","floor","col","console","log","x","y","map","forEach","adjacent","setTile","Tiles","NUMBER","tileType","n","qs","querySelector","tile","createElement","classList","add","dataset","gridColumn","gridRow","FLAG","MARK","MINE","MINE_BOOM","INCORRECT_MINE","replaceWith","appendChild","lostCoords","isMine","isFlagged","which","error","counter","TIME","isNegative","src","sizeBaseline","mainCont","uiWidth","clientWidth","uiHeight","clientHeight","maxHeight","body","maxWidth","size","min","removeEventListener","EventTarget","Object","getPrototypeOf","Model","mines","length","parseField","field","mineList","markedFlags","view","fld","lst","c","i","FieldFlags","push","undefined","REVEALED","isRecursive","Error","isRevealed","getAdjacentCount","concat","revealTile","revealed","revealMap","dropFlag","dropTile","MarkTypes","UNKNOWN","FLAGGED","MARKED","UNMARKED","count","_revealed","randomInt","max","random","DEFAULT_GLOBAL_OPTIONS","freeze","marks","Game","generateMines","bindView","gameStarted","interactuable","initListeners","startTimer","stopTimer","timerOn","timerStart","performance","now","setTimeout","doTimer","nextTimer","startGame","stopGame","gameLost","isComplete","gameWon","getTileType","markTileFlag","markTile","unmarkTile","destroy","rowCount","colCount","rnd","includes","GAME_MODES","gi","difficulty","g","params","assign","game","newGame","call","changeDifficulty","remove","toggleMarks","toggle","Array","from","querySelectorAll","li","contains","l","target","action"],"mappings":";;AIAA;;AACA,IAAMyL,UAAU,GAAG;AACf,cAAY;AACR5J,IAAAA,IAAI,EAAE,EADE;ADFhB,ACIQD,AHJR,ACAA,AFAA,IIIQA,IAAI,CFJH0H,CEIK,EAFE,MFFhB,CAAmBtC,GAAnB,EAAwBuC,GAAxB,EAA6B;AEKrBpH,AFJJ,IEIIA,KFJG2B,IEIM,AFJF,CAACC,CEIG,IFJR,CAAWiD,GAAG,GAAGlD,IAAI,CAAC0F,MAAL,MAAiBD,GAAG,GAAGvC,GAAvB,CAAjB,CAAP;ACAJ,ACCgB,AFAf,AFDD,GIAmB;AAMf,kBAAgB;ADLpB,ACMQnF,AJNR,IIMQA,IAAI,EAAE,EADM;AAEZD,IAAAA,IAAI,EAAE,EAFM;AAGZO,AJPR,IIOQA,SAAS,EAAE;AAHC,GAND;AAWf,AJRJ,YIQc;AACNN,IAAAA,IAAI,EAAE,EADA;AAEND,AJTR,IISQA,IAAI,EAAE,EAFA;AAGNO,IAAAA,SAAS,EAAE;ADXnB,ACQc,AJNd,GILmB,CDGbsH,sBAAsB,GAAGtC,MAAM,CAACuC,MAAP,CAAc;AACzCC,ACYA,EDZAA,KAAK,EAAE,GCYG,EDb+B;AAEzC9G,ACYIhB,AJXR,EGDIgB,ECYIhB,IDZE,ACYE,EDZA,ACYE,CADA;ADb+B,ACerCD,CDfuB,CAA/B,ECeQA,IAAI,EAAE,CAFA;AAGN0F,AJZR,IIYQA,KAAK,EAAE;AAHD,IDRRsC;AACF,ACTe,AJQnB,CIRA,qBDSsE;AAAA,ACctEjH,MAAM,CAAC+I,CDdW9J,CCclB,GDdsE,ACc1D,EAAZ,MDdkBA,IAAoD;AAAA,ACetEe,AJfA,MIeM,CAACzB,CDfiBW,IAA8C,QAA9CA,ACexB,GAAuB,CDf+C;AAAA,ACgBlE8H,EAAAA,KAAK,CDhBqBxH,CCgBnB,IADY,IDf+C,QAAxCA,SAAwC;AAAA,ACiBlEU,EAAAA,EHzBEwE,IEQmCnG,ACiB/B,EAAE,IAFW,ODf+C,QAA7BA,aAA6B;AAAA,ACkBlEyK,AHxBA,EGwBAA,UAAU,EAAE,SHxBuB,GEMiBrE,KAAc;AAAA,ACe/C,AHrBgB,CGqBvC,ODfwDA,AFNtC1F,IAAqB,CEM+B,OFNpDA,IAAqB,gBEMyB,EAAM;ACqBtEe,AH3BuC,MG2BjC,CAACD,CH3BiBb,IAAe,QAAfA,GG2BxB,CAAwB,AH3Be,MG2BvC,EAAgC,YAAW;ADrB2B,ACsBlEc,AH5BmC,EG4BnCA,MAAM,AH5BoB2E,CG4BnBsE,CAAP,GAAW,AH5BwB,QAATtE,IG4BJ,CH5Ba;AG6B/B,QAAIuE,MAAM,GAAG;ADrBb,ACsBI3K,AH9B2B,MG8B3BA,EDtBAoG,KAAK,CAACC,KCsBO,CDtBb,CCsBe5E,IDtBE,CAArB,CCsByB,CDtBD,ACsBEzB;ADrBtB,ACoBS,KAAb;ADnBIoG,ACsBJH,AH/BA,IG+BAA,EDtBIG,GFTC1F,CG+BC,CDtBG,ACsBFkK,EH/BP,CESYlC,EFTAhI,CG+BZ,CDtBgB,ACsBFiK,CDtBGhC,CFTjB,IG+BA,EAAsB4B,MDtBV,CAAmB5J,GCsBC,CDtBpB,ACsBqBc,EDtBIf,IAAzB,ACsB2B,CAACV,CDtBGiB,SAA/B,CAAR,ECsB6B,CAAqBwJ,UAAtB,CAAhC;ADrBC,ACsBD,AH/BA,SG+BKI,AH/BAlK,IG+BL,AH/BA,GG+BY,AH/BAA,IG+BI+H,AH/BhB,UG+BY,CAASiC,MAAT,CAAZ;AACH,AH/BG,GGyBJ,MHzBS1J,SAAL,GAAiBmF,KAAK,CAACC,MAAvB;AEUA,QAAI,CAACrG,aAAL,EAAoB;AAChBA,ACsBR,AHpCmC,MEc3BA,KCsBC8K,OAAT,CDtBqB,ECsBF,CDtBKvC,KFVY,KAAKjC,UAAL,CAAgBF,CEU5C,IFV4B,CAJD;AEe9B,ACsBD,QAAI3E,MAAM,CAAC+I,EAAP,IAAa/I,MAAM,CAAC+I,EAAP,CAAUK,IAA3B,EAAiC;AAC7BpJ,AHtC2B,MGsC3BA,MAAM,CAAC+I,EAAP,CAAUK,IAAV,CAAeX,OAAf;ADrBJ,ACsBC,SDtBIlK,aAAL,GAAqBA,aAArB;AACA,AFdE,SEcGD,AFdEwG,KEcP,AFlB+B,GEkBlB,IAAIJ,YAAJ,CAAU;AAAEzF,ACsBzBe,AHpCc,IGoCdA,EDtByBf,GFdN8F,CEcU,ACsBvB,CAACgE,CDtBkB9J,CCsBzB,GDtBuB,ACsBX,CHxCmB,CGwC/B;ADtB+BC,ACuB/B+J,AHpCA3H,IGoCA2H,AHpCA3H,CGoCC,CDvB8BpC,ACuB7BoK,IDvBiC,ACuBnC,CAAOtJ,AHpCA,CEawBd,AFbvBqC,GAAR,CEauB,AFbX,CGoCC,CAACwH,EAAd,CHpCiBjE,KAAjB;AEaqCH,ACwBxC,AHpCGrD,IAAAA,EEYqCqD,KAAK,AFZnC,CAACpD,CEY6BoD,EFZrC,CAAY,KAAKI,QAAjB,EAN+B,CAQ/B;AEUuB,KAAV,CAAb;AACA,ACyBJ,AHnCI,SEUKE,AFVAD,EGmCAuE,EDzBL,GAAY,IAAIlL,AFVhB,GAAmB,CAAnB,GGmCJ,CAA0B2K,EDzBV,CAAS,OCyBzB,EAAsC;ADzBXzK,AC0BvBI,AHnCH,IGmCGA,ED1BuBJ,MC0Bf,CAAC4D,MD1B2B,EAAb5D,KC0BvB,CAAuB,OD1BF,oCC0BrB,EAAoE+D,SAApE,CAA8EkH,MAA9E,CAAqF,SAArF;AD1BsCvK,AC2BtCN,IAAAA,ED3BsCM,IAAI,EAAJA,AC2B9B,CAACkD,GD3BY,UC2BrB,mEAA+E6G,UAA/E,UAA+F1G,SAA/F,CAAyGC,GAAzG,CAA6G,SAA7G;AD3B4CrD,AC4B5Cc,IAAAA,ED5B4Cd,IAAI,AC4B1C,CAACX,CD5BqCW,IAAvB,QC4BrB,CAAqB8J,UAArB,GAAkCA,UAAlC;AD5BkD1K,AC6BlD+K,IAAAA,ED7BkD/K,KAAK,AC6BhD,ED7BkD,KAAKA;AAAzC,AC8BxB,KD9Be,CAAZ,uBFPK2G,MAAM;AEQX,AFPA,SEOK3G,EFPA2G,GEOL,CAAWkC,AFPX,GAAYlC,IAAZ,CEOA,CAAoB,KAAKA,IAAzB;AAEA,AC6BJ,AHrCC,SEQQmC,EC6BAqC,SD7BL,EC6BJ,CD7BuB,EC6BA,GD7BnB;AACA,AC6BAzJ,IAAAA,KD7BKqH,CC6BC,CAAC9I,WD7BP,EC6BA,CD7BqB,AC6BAyI,ID7BrB,CC6BA,GAA6B,CAAChH,MAAM,CAACzB,aAAP,CAAqByI,KAAnD;AD3BA,AC6BArI,AJ/CR,II+CQA,AJ/CFtB,KGkBOiK,GC6BG,CAACnF,EJ/CA,GAAG7E,IGkBZ,IC6BA,CAAuB,UJ/C/B,oBI+CQ,EAAuDgF,SAAvD,CAAiEoH,MAAjE,CAAwE,SAAxE;AD5BH,AC6BA,AJ/CL,IAAMnM,WAAW,GAAG,CAAEC,YCiBPmH,IDjBK,EAAMlH,CCiBJ,gBDjBF,EAAUC,iBAAV,EAAcC,iBAAd,EAAkBC,iBAAlB,EAAsBC,iBAAtB,EAA0BC,iBAA1B,EAA8BC,iBAA9B,EAAkCC,iBAAlC,EAAsCC,kBAAtC,CAApB;ACkBQ,ADhBR,IAAMC,MCgBMgH,GAAG,ADhBA,GCgBG,ADhBA,ECgBV,GDhBR;AI+CImE,AH9BI,ADhBR,EI8CIA,EJ9CElL,KI8CK,CH9BCgH,GAAG,ADhBA,GCgBG,ADhBA,ECgBV,KDhBR;AIgDIxG,AJ/CJ,EI+CIA,EJ/CEP,MI+CM,CAACQ,CJ/CC,GAAG,QAAjB,EI+CI,CAAwB,aAAxB,EAAuCmB,gBAAvC,CAAwD,OAAxD,EAAiE,YAAW;AACxEsJ,AHhCA,IGgCAA,OAAO,AHhCF,IAAIjE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKnG,IAAzB,CEAY,CFAmBmG,CAAC,EAAhC,EAAoC;AECpC,ACgCH,AHhCOF,GG8BR,CJ7CE7G,ICeM6G,GEACxF,AFAE,CAAC0F,CAAD,CAAH,GAAS,EAAT,CEAJ,GAAiB,CACb,KAAKzF,iBAAL,CAAuBC,IAAvB,CAA4B,IAA5B,CADa,EAEb,KAAKC,sBAAL,CAA4BD,IAA5B,CAAiC,IAAjC,CAFa,CAAjB;AAIA,AC8BJ+J,AHjCK,EGiCLA,KAAK,CAACC,GD9BG3E,CC8BT,CAAWtG,ED9BP,CAAUoB,KC8BK,CAAC8J,UD9BhB,CAA2B,KC8BpB,CAA0B,CD9BjC,EAAoC,KAAKnK,OC8BlC,CAAX,CD9BwC,CAAe,AC8BAiC,CD9Bf,CAApC,KC8BJ,CAA+D,UAAAmI,EAAE,EAAI;AD7BjE,AC8BAA,IAAAA,EAAE,CAAC/J,ID9BEkF,IAAL,CAAUlF,OC8BV,CAAoB,OAApB,CD9BA,CAA2B,AC8BE,YD9B7B,AC8BwC,ED9BC,KAAKL,SAAL,CAAe,CAAf,CAAzC;AACH,AC8BO,AHxCU,UGwCNoK,EAAE,CAACxH,SAAH,CAAayH,QAAb,CAAsB,MAAtB,CAAJ,EAAmC,QHjCzBpF,KAPA;AGyCNmF,AHzCM,QGyCNA,EAAE,CAACxH,SAAH,CAAakH,MAAb,CAAoB,MAApB;AACH,AJpDT,OIkDQ,MAEO,SJpDuB;AIqD1BG,AH3CM,ADVoB,QIqD1BA,KAAK,CAACC,IAAN,CAAWjL,QAAQ,CAACkL,ID/BpB,YC+BW,CAA0B,oBAA1B,CAAX,EAA4DlI,OAA5D,CAAoE,UAAAqI,CAAC,EAAI;AD9BjF,AC+BYA,AHrCZ,UGqCYA,CD/BP5C,AC+BQ,CAAC9E,SAAF,CD/BZ,AC+BwBkH,GD/BL,GC+BP,CD/BZ,AC+B+B,MAAnB,yBHrCS;AEOrB,AC+BS,AHtCY,ADjBa,QAAxBlL,CIqDF,ED7BHiJ,EHxB6B,CCiBzBlC,CAAY,MEOrB,AHxBU/G,KAAwB;AGyBrC,AC+BWwL,AHtCJ,ADlB8B,QIwD1BA,AJxDSvL,EIwDP,CAAC+D,SAAH,CAAaC,AJxDa,GIwD1B,CAAiB,IJxDRhE,EIwDT,WJxD0B;AIyD7B,AHtCD,cAAIkD,CAAC,GAAGN,IAAI,CAACC,KAAL,CAAWiE,CAAC,GAAG,KAAKpG,IAApB,CAAR;AGuCH,AHtCG,ADpB8B,KIiDlC,SH7BQuC,CAAC,GAAG6D,CAAC,GAAG,KAAKpG,IAAL,GAAYwC,CAAxB;AGuCP,AHtCOyD,GG2BR,OH3BQA,GAAG,CAAC1D,CAAD,CAAH,CAAOC,CAAP,IAAYiD,KAAK,CAACY,GEMf,OFNS,CAAiBzC,IAA7B;AEOJ,ACiCJlE,AHvCQwG,ADrBJ,EI4DJxG,QAAQ,AHvCAwG,CEMCkC,ACiCAlF,EHvCE,CAACoD,IAAJ,CAAS,KEMb,ACiCJ,CAAuB,EDjCE,KAArB,GCiCJ,EAAmCxF,gBAAnC,CAAoD,OAApD,EAA6D,UAASE,KAAT,EAAgB;ADhCzE,ACiCA,AHxCeuB,ADnBf,QI2DI,CAACvB,CJ3DA1B,CG0BAiJ,CFPUhG,CAAC,CGwCN,CAACyI,AHxCIzI,CAAF,IEOb,CCiCK,CAAagB,CJ3DlB,GAAqBjE,GI2DhB,CAAqB2L,MAA1B,EAAkC,CJ3DlC;AG2BH,ACgCuC,AHxClBzI,ADlBlB,UAAKnD,ECkBamD,CAAC,EAADA,ADlBlB,GAAanD,KAAb;AI0D6C,AHxC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","file":"main.fb6bbcaf.js","sourceRoot":"..\\src","sourcesContent":["import c0   from \"../static/number_0.gif\";\r\nimport c1   from \"../static/number_1.gif\";\r\nimport c2   from \"../static/number_2.gif\";\r\nimport c3   from \"../static/number_3.gif\";\r\nimport c4   from \"../static/number_4.gif\";\r\nimport c5   from \"../static/number_5.gif\";\r\nimport c6   from \"../static/number_6.gif\";\r\nimport c7   from \"../static/number_7.gif\";\r\nimport c8   from \"../static/number_8.gif\";\r\nimport c9   from \"../static/number_9.gif\";\r\nimport cNEG from \"../static/number_neg.gif\";\r\nconst COUNTER_NEG = cNEG;\r\nconst COUNTER_SRC = [ c0, c1, c2, c3, c4, c5, c6, c7, c8, c9 ];\r\n\r\nconst FACE_BASE = \"0px\";\r\nconst FACE_LOST = \"-80px\";\r\nconst FACE_WON = \"-120px\";\r\n\r\nclass View extends EventTarget {\r\n    constructor({ model, globalOptions }) {\r\n        super();\r\n\r\n        this.globalOptions = globalOptions;\r\n        this.model = model;\r\n        this.tileSize = this.calculateTileSize();\r\n\r\n        this.playground = document.getElementById(\"playground\");\r\n        this.face = document.getElementById(\"face-button\");\r\n        this.controls = document.getElementById(\"controls\");\r\n\r\n        this.controls.style.setProperty(\"--face-position\", FACE_BASE);\r\n\r\n        this.playground.style.setProperty(\"--cols\", this.model.cols);\r\n        this.playground.style.setProperty(\"--rows\", this.model.rows);\r\n\r\n        this.playground.style.setProperty(\"--tile-size\", this.tileSize + \"px\");\r\n\r\n        while (this.playground.firstChild) {\r\n            this.playground.removeChild(this.playground.firstChild);\r\n        }\r\n\r\n        this.setNumber(View.Counters.MINES, this.model.mineCount);\r\n\r\n        this.initViewListeners();\r\n    }\r\n\r\n    initViewListeners() {\r\n        this.listeners = [\r\n            this.onPlaygroundClick.bind(this),\r\n            this.onPlaygroundRightClick.bind(this),\r\n            this.onResize.bind(this),\r\n        ];\r\n        this.playground.addEventListener(\"click\", this.listeners[0]);\r\n        this.playground.addEventListener(\"contextmenu\", this.listeners[1]);\r\n        window.addEventListener(\"resize\", this.listeners[2]);\r\n    }\r\n\r\n    onResize(event) {\r\n        if (this.globalOptions.resize) {\r\n            this.tileSize = this.calculateTileSize();\r\n            this.playground.style.setProperty(\"--tile-size\", this.tileSize + \"px\");\r\n        }\r\n    }\r\n\r\n    onPlaygroundClick(event) {\r\n        event.preventDefault();\r\n        this.dispatch(\"click\", this.locateClickFromEvent(event));\r\n    }\r\n\r\n    onPlaygroundRightClick(event) {\r\n        event.preventDefault();\r\n        this.dispatch(\"rightClick\", this.locateClickFromEvent(event));\r\n    }\r\n\r\n    dispatch(eventName, detail) {\r\n        let event = new CustomEvent(eventName, {\r\n            detail,\r\n        });\r\n        this.dispatchEvent(event);\r\n    }\r\n\r\n    locateClickFromEvent(event) {\r\n        let box = this.playground.getBoundingClientRect();\r\n        let translationX = event.clientX - box.left;\r\n        let translationY = event.clientY - box.top;\r\n        let row = Math.floor(translationY / this.tileSize);\r\n        let col = Math.floor(translationX / this.tileSize);\r\n\r\n        console.log(`Click en {${col},${row}}`)\r\n        return {\r\n            x: col,\r\n            y: row,\r\n        };\r\n    }\r\n\r\n    revealMap(map) {\r\n        // map = [ {x, y, adjacent } ]\r\n        map.forEach(({ x, y, adjacent}) => this.setTile(x, y, View.Tiles.NUMBER, adjacent));\r\n    }\r\n    setTile(x, y, tileType, n) {\r\n        let qs = this.playground.querySelector(`[data-row=\"${y}\"][data-col=\"${x}\"]`);\r\n\r\n        let tile = document.createElement(\"i\");\r\n        tile.classList.add(\"tile\");\r\n        tile.dataset.row = y;\r\n        tile.dataset.col = x;\r\n        tile.style.gridColumn = x + 1; // grid is 1-indexed\r\n        tile.style.gridRow = y + 1;\r\n        switch (tileType) {\r\n            case View.Tiles.FLAG:\r\n                tile.classList.add(\"flag\");\r\n            break;\r\n            case View.Tiles.MARK:\r\n                tile.classList.add(\"mark\");\r\n            break;\r\n            case View.Tiles.NUMBER:\r\n                tile.classList.add(`number-${n}`);\r\n            break;\r\n            case View.Tiles.MINE:\r\n                tile.classList.add(\"mine\");\r\n            break;\r\n            case View.Tiles.MINE_BOOM:\r\n                tile.classList.add(\"mine-exploded\");\r\n            break;\r\n            case View.Tiles.INCORRECT_MINE:\r\n                tile.classList.add(\"incorrect-mine\");\r\n            break;\r\n        }\r\n        \r\n        if (qs) {\r\n            qs.replaceWith(tile);\r\n        } else {\r\n            this.playground.appendChild(tile);\r\n        }\r\n    }\r\n\r\n    dropTile(x, y) {\r\n        let qs = this.playground.querySelector(`[data-row=\"${y}\"][data-col=\"${x}\"]`);\r\n        if (qs) {\r\n            this.playground.removeChild(qs);\r\n        }\r\n    }\r\n\r\n    // ¿No necesita la view una referencia al model?\r\n    gameLost(lostCoords) {\r\n        this.controls.style.setProperty(\"--face-position\", FACE_LOST);\r\n        for (let x = 0; x < this.model.cols; x++) {\r\n            for (let y = 0; y < this.model.rows; y++) {\r\n                console.log(x + \"-\" + y + \"-\" + this.model.isMine(x, y) + \"-\" + this.model.isFlagged(x, y));\r\n                if (this.model.isMine(x, y)) {\r\n                    this.setTile(\r\n                        x,\r\n                        y,\r\n                        lostCoords.x === x && lostCoords.y === y ? View.Tiles.MINE_BOOM : View.Tiles.MINE\r\n                    );\r\n                } else if (this.model.isFlagged(x, y)) {\r\n                    this.setTile(x, y, View.Tiles.INCORRECT_MINE);\r\n                }\r\n            }\r\n        }\r\n        // for (let minePos of this.model.mineList) {\r\n        //     this.setTile(\r\n        //         minePos.x,\r\n        //         minePos.y,\r\n        //         lostCoords.x === minePos.x && lostCoords.y === minePos.y ? View.Tiles.MINE_BOOM : View.Tiles.MINE\r\n        //     );\r\n        // }\r\n    }\r\n\r\n    gameWon() {\r\n        this.controls.style.setProperty(\"--face-position\", FACE_WON);\r\n    }\r\n\r\n    setNumber(which, n) {\r\n        if (n >= 1000 || n <= -1000) {\r\n            console.error(`setNumber(${which}, ${n}): n too big`);\r\n            n = n % 1000;\r\n        }\r\n\r\n        let counter;\r\n        switch (which) {\r\n            case View.Counters.MINES:\r\n                counter = document.getElementById(\"mine-counter\");\r\n            break;\r\n            case View.Counters.TIME:\r\n                counter = document.getElementById(\"time-counter\");\r\n            break;\r\n        }\r\n\r\n        let isNegative = false;\r\n        if (n < 0) {\r\n            isNegative = true;\r\n            n *= -1;\r\n        }\r\n        counter.querySelector(`img:nth-child(1)`).src = isNegative ? COUNTER_NEG : COUNTER_SRC[Math.floor(n / 100)];\r\n        counter.querySelector(`img:nth-child(2)`).src = COUNTER_SRC[Math.floor((n % 100) / 10)];\r\n        counter.querySelector(`img:nth-child(3)`).src = COUNTER_SRC[Math.floor(n % 10)];\r\n    }\r\n\r\n    calculateTileSize() {\r\n        if (!View.sizeBaseline) {\r\n            let mainCont = document.getElementById(\"full-container\");\r\n            let controls = document.getElementById(\"controls\");\r\n    \r\n            View.sizeBaseline = {\r\n                uiWidth: controls.clientWidth - mainCont.clientWidth,\r\n                uiHeight: -mainCont.clientHeight,\r\n            };\r\n        }\r\n\r\n        // Height uses mainCont height\r\n        let maxHeight = document.body.clientHeight + View.sizeBaseline.uiHeight;\r\n        // But width is just the borders... so CONTAINER - Controls-width\r\n        let maxWidth = document.body.clientWidth + View.sizeBaseline.uiWidth;\r\n\r\n        let size = Math.min(maxWidth / this.model.cols, maxHeight / this.model.rows);\r\n\r\n        // floor...?\r\n        size = Math.floor(size);\r\n\r\n        return size;\r\n    }\r\n\r\n    destroy() {\r\n        this.playground.removeEventListener(\"click\", this.listeners[0]);\r\n        this.playground.removeEventListener(\"contextmenu\", this.listeners[1]);\r\n        window.removeEventListener(\"resize\", this.listeners[2]);\r\n    }\r\n}\r\n\r\nObject.getPrototypeOf(View).Tiles = {\r\n    FLAG: 0,\r\n    MARK: 1,\r\n    NUMBER: 2,\r\n    MINE: 3,\r\n    MINE_BOOM: 4,\r\n    INCORRECT_MINE: 5,\r\n};\r\n\r\nObject.getPrototypeOf(View).Counters = {\r\n    MINES: 0,\r\n    TIME: 1,\r\n};\r\n\r\nexport { View };","import { View } from './view';\r\n\r\nclass Model {\r\n\r\n    constructor({ cols, rows, mines }) {\r\n        this.cols = cols;\r\n        this.rows = rows;\r\n        this.mineCount = mines.length;\r\n        [ this.field, this.mineList ] = this.parseField(mines);\r\n        console.log(this.field);\r\n        console.log(this.mineList);\r\n\r\n        // Intermediate - could be inferred from this.field to avoid mishaps\r\n        this.markedFlags = 0;\r\n    }\r\n\r\n    bindView(view) {\r\n        this.view = view;\r\n    }\r\n\r\n    get revealed() {\r\n        return this._revealed || 0;\r\n    }\r\n\r\n    set revealed(n) {\r\n        if (!this._revealed) this._revealed = 0;\r\n        this._revealed += n;\r\n    }\r\n\r\n    parseField(mines) {\r\n        let fld = {};\r\n        let lst = [];\r\n        for (let c = 0; c < this.cols; c++) {\r\n            fld[c] = {};\r\n        }\r\n\r\n        for (let i of mines) {\r\n            // i = y*rows + x;\r\n            let y = Math.floor(i / this.cols);\r\n            let x = i - this.cols * y;\r\n            fld[x][y] = Model.FieldFlags.MINE;\r\n            lst.push({ x, y });\r\n        }\r\n        return [ fld, lst ];\r\n    }\r\n\r\n    isMine(x, y) {\r\n        return this.field[x][y] !== undefined && (this.field[x][y] & Model.FieldFlags.MINE) > 0;\r\n    }\r\n\r\n    isRevealed(x, y) {\r\n        return this.field[x][y] !== undefined && (this.field[x][y] & Model.FieldFlags.REVEALED) > 0;\r\n    }\r\n\r\n    isFlagged(x, y) {\r\n        return this.field[x][y] !== undefined && (this.field[x][y] & Model.FieldFlags.FLAG) > 0;\r\n    }\r\n\r\n    // isRecursive haces las veces de flagholder\r\n    revealTile(x, y, isRecursive) {\r\n        if (this.isMine(x, y)) { throw new Error(\"Mine\"); }\r\n        if (this.isRevealed(x, y) || this.isFlagged(x, y)) { return []; }\r\n        let map = [];\r\n        let adjacent = this.getAdjacentCount(x, y);\r\n        map.push({ x, y, adjacent });\r\n        this.field[x][y] |= Model.FieldFlags.REVEALED;\r\n\r\n        if (adjacent === 0) {\r\n            // top left\r\n            if (x > 0 && y > 0)                             \r\n                map = map.concat(this.revealTile(x - 1, y - 1, true));\r\n            // top\r\n            if (y > 0)                                      \r\n                map = map.concat(this.revealTile(x,     y - 1, true));\r\n            // top right\r\n            if (y > 0 && x < (this.cols - 1))               \r\n                map = map.concat(this.revealTile(x + 1, y - 1, true));\r\n            // left\r\n            if (x > 0)                                      \r\n                map = map.concat(this.revealTile(x - 1, y,     true));\r\n            // right\r\n            if (x < (this.cols - 1))                        \r\n                map = map.concat(this.revealTile(x + 1, y,     true));\r\n            // bottom left\r\n            if (x > 0 && y < (this.rows - 1))               \r\n                map = map.concat(this.revealTile(x - 1, y + 1, true));\r\n            // bottom\r\n            if (y < (this.rows - 1))                        \r\n                map = map.concat(this.revealTile(x,     y + 1, true));\r\n            // bottom right\r\n            if (x < (this.cols - 1) && y < (this.rows - 1)) \r\n                map = map.concat(this.revealTile(x + 1, y + 1, true));\r\n        }\r\n\r\n        if (!isRecursive) {\r\n            this.revealed = map.length;\r\n            this.view.revealMap(map);\r\n        } else {\r\n            return map;\r\n        }\r\n    }\r\n\r\n    markTileFlag(x, y) {\r\n        this.field[x][y] |= Model.FieldFlags.FLAG;\r\n        this.markedFlags++;\r\n\r\n        this.view.setTile(x, y, View.Tiles.FLAG);\r\n\r\n        // Aquí o en setTile? o en Game?\r\n        this.view.setNumber(View.Counters.MINES, this.mineCount - this.markedFlags);\r\n    }\r\n\r\n    markTile(x, y) {\r\n        // Marks (?) a tile\r\n        this.field[x][y] |= Model.FieldFlags.MARK;\r\n        this.field[x][y] &= ~Model.FieldFlags.FLAG;\r\n\r\n        this.view.setTile(x, y, View.Tiles.MARK);\r\n\r\n        // Always subtract one from markedFlags\r\n        this.markedFlags--;\r\n        this.view.setNumber(View.Counters.MINES, this.mineCount - this.markedFlags);\r\n    }\r\n\r\n    unmarkTile(x, y) {\r\n        // Unmarks a tile. Subtracts from markedFlags only if field.x.y has Model.FieldFlags.FLAG\r\n        let dropFlag = (this.field[x][y] & Model.FieldFlags.FLAG) > 0;\r\n\r\n        this.field[x][y] &= ~Model.FieldFlags.MARK;\r\n        this.field[x][y] &= ~Model.FieldFlags.FLAG;\r\n\r\n        this.view.dropTile(x, y);\r\n\r\n        if (dropFlag) {\r\n            this.markedFlags--;\r\n            this.view.setNumber(View.Counters.MINES, this.mineCount - this.markedFlags);\r\n        }\r\n    }\r\n\r\n    getTileType(x, y) {\r\n        // returns FlagTypes\r\n        // If revealed => unknown (invalid op)\r\n        if (!this.field[x][y]) return Model.MarkTypes.UNKNOWN;\r\n\r\n        if ((this.field[x][y] & Model.FieldFlags.REVEALED) > 0) return Model.MarkTypes.UNKNOWN;\r\n\r\n        if ((this.field[x][y] & Model.FieldFlags.FLAG) > 0) return Model.MarkTypes.FLAGGED;\r\n\r\n        if ((this.field[x][y] & Model.FieldFlags.MARK) > 0) return Model.MarkTypes.MARKED;\r\n\r\n        return Model.MarkTypes.UNMARKED;\r\n    }\r\n\r\n    getAdjacentCount(x, y) {\r\n        let count = 0;\r\n        if (x > 0 && y > 0                             && this.isMine(x - 1, y - 1)) count++;\r\n        if (y > 0                                      && this.isMine(x,     y - 1)) count++;\r\n        if (y > 0 && x < (this.cols - 1)               && this.isMine(x + 1, y - 1)) count++;\r\n        if (x > 0                                      && this.isMine(x - 1, y))     count++;\r\n        if (x < (this.cols - 1)                        && this.isMine(x + 1, y))     count++;\r\n        if (x > 0 && y < (this.rows - 1)               && this.isMine(x - 1, y + 1)) count++;\r\n        if (y < (this.rows - 1)                        && this.isMine(x,     y + 1)) count++;\r\n        if (x < (this.cols - 1) && y < (this.rows - 1) && this.isMine(x + 1, y + 1)) count++;\r\n\r\n        return count;\r\n    }\r\n}\r\n\r\nObject.getPrototypeOf(Model).FieldFlags = {\r\n    MINE:     0b1,\r\n    REVEALED: 0b10,\r\n    FLAG:     0b100,\r\n    MARK:     0b1000,\r\n};\r\n\r\nObject.getPrototypeOf(Model).MarkTypes = {\r\n    UNKNOWN: 0,\r\n    UNMARKED: 1,\r\n    FLAGGED: 2,\r\n    MARKED: 3,\r\n};\r\n\r\nexport { Model };","function randomInt(min, max) {\r\n    return Math.floor(min + Math.random() * (max - min))\r\n}\r\n\r\nexport { randomInt };","import { Model } from './model';\r\nimport { View } from './view';\r\nimport { randomInt } from './utils';\r\n\r\nconst DEFAULT_GLOBAL_OPTIONS = Object.freeze({\r\n    marks: false,\r\n    resize: true,\r\n});\r\n\r\nclass Game {\r\n    constructor({ cols, rows, mineCount, globalOptions, mines = [] }) {\r\n\r\n        if (mines.length === 0) {\r\n            // Generar minas\r\n            mines = Game.generateMines(rows, cols, mineCount);\r\n        }\r\n\r\n        if (!globalOptions) {\r\n            globalOptions = DEFAULT_GLOBAL_OPTIONS;\r\n        }\r\n\r\n        this.globalOptions = globalOptions;\r\n        this.model = new Model({ cols, rows, mines });\r\n        this.view = new View({ globalOptions, cols, rows, model: this.model});\r\n        this.model.bindView(this.view);\r\n\r\n        this.gameStarted = false;\r\n        this.interactuable = true;\r\n\r\n        this.initListeners();\r\n    }\r\n\r\n    initListeners() {\r\n        this.listeners = [\r\n            this.onPlaygroundClick.bind(this),\r\n            this.onPlaygroundRightClick.bind(this),\r\n        ];\r\n        this.view.addEventListener(\"click\", this.listeners[0]);\r\n        this.view.addEventListener(\"rightClick\", this.listeners[1]);\r\n    }\r\n\r\n    startGame() {\r\n        this.gameStarted = true;\r\n        this.startTimer();\r\n    }\r\n\r\n    stopGame() {\r\n        this.interactuable = false;\r\n        this.stopTimer();\r\n    }\r\n\r\n    startTimer() {\r\n        this.timerOn = true;\r\n        this.timerStart = performance.now();\r\n        setTimeout(this.doTimer.bind(this), 1000);\r\n    }\r\n\r\n    stopTimer() {\r\n        this.timerOn = false;\r\n    }\r\n\r\n    doTimer() {\r\n        if (!this.timerOn) return;\r\n        this.view.setNumber(View.Counters.TIME, Math.floor((performance.now() - this.timerStart) / 1000));\r\n        let nextTimer = (performance.now() - this.timerStart) % 1000;\r\n        setTimeout(this.doTimer.bind(this), 1000 - nextTimer);\r\n    }\r\n\r\n    onPlaygroundClick(event) {\r\n        if (!this.interactuable) return false;\r\n        if (!this.gameStarted) {\r\n            this.startGame();\r\n        }\r\n\r\n        if (this.model.isRevealed(event.detail.x, event.detail.y)) {\r\n            return false; // Noop\r\n        }\r\n\r\n        if (this.model.isMine(event.detail.x, event.detail.y)) {\r\n            this.stopGame();\r\n            this.view.gameLost({ x: event.detail.x, y: event.detail.y });\r\n        } else {\r\n            this.model.revealTile(event.detail.x, event.detail.y);\r\n        }\r\n\r\n        if (this.isComplete()) {\r\n            this.stopGame();\r\n            this.view.gameWon();\r\n        }\r\n    }\r\n    \r\n    onPlaygroundRightClick(event) {\r\n        if (!this.interactuable) return false;\r\n        if (!this.gameStarted) {\r\n            this.startGame();\r\n        }\r\n\r\n        if (this.model.isRevealed(event.detail.x, event.detail.y)) {\r\n            return false; // Noop\r\n        }\r\n\r\n        switch (this.model.getTileType(event.detail.x, event.detail.y)) {\r\n            case Model.MarkTypes.UNMARKED:\r\n            case Model.MarkTypes.UNKNOWN:\r\n                // Just flag\r\n                this.model.markTileFlag(event.detail.x, event.detail.y);\r\n            break;\r\n            case Model.MarkTypes.FLAGGED:\r\n                // Unmark if !global.marks, mark (?) if true\r\n                if (this.globalOptions.marks) {\r\n                    this.model.markTile(event.detail.x, event.detail.y);\r\n                } else {\r\n                    this.model.unmarkTile(event.detail.x, event.detail.y);\r\n                }\r\n            break;\r\n            case Model.MarkTypes.MARKED:\r\n                // Always unmark\r\n                this.model.unmarkTile(event.detail.x, event.detail.y);\r\n            break;\r\n        }\r\n    }\r\n\r\n    isComplete() {\r\n        return this.model.revealed === this.model.cols * this.model.rows - this.model.mineCount;\r\n    }\r\n\r\n    destroy() {\r\n        this.view.removeEventListener(\"click\", this.listeners[0]);\r\n        this.view.removeEventListener(\"rightClick\", this.listeners[1]);\r\n        this.view.destroy();\r\n    }\r\n\r\n    static generateMines(rowCount, colCount, mineCount) {\r\n\r\n        let max = rowCount * colCount - 1;\r\n        let mines = [];\r\n    \r\n        while (mines.length < mineCount) {\r\n            let rnd = randomInt(0, max);\r\n            if (!mines.includes(rnd)) {\r\n                mines.push(rnd);\r\n            }\r\n        }\r\n    \r\n        return mines;\r\n    }\r\n}\r\n\r\nexport { Game };","import { Game } from './game';\r\nconst GAME_MODES = {\r\n    \"Beginner\": {\r\n        rows: 10,\r\n        cols: 10,\r\n        mineCount: 10,\r\n    },\r\n    \"Intermediate\": {\r\n        rows: 16,\r\n        cols: 16,\r\n        mineCount: 40,\r\n    },\r\n    \"Expert\": {\r\n        rows: 16,\r\n        cols: 31,\r\n        mineCount: 99,\r\n    },\r\n    \"Custom\": {\r\n        rows: 1,\r\n        cols: 1,\r\n        mines: 1,\r\n    },\r\n};\r\n\r\nwindow.gi = {};\r\nwindow.globalOptions = {\r\n    marks: true,\r\n    resize: true,\r\n    difficulty: \"Intermediate\",\r\n};\r\n\r\nwindow.addEventListener(\"load\", function() {\r\n    window.g = function() {\r\n        let params = {\r\n            globalOptions: window.globalOptions,\r\n        };\r\n        Object.assign(params, GAME_MODES[window.globalOptions.difficulty]);\r\n        this.game = new Game(params);\r\n    };\r\n\r\n    function newGame() {\r\n        if (window.gi && window.gi.game) {\r\n            window.gi.game.destroy();\r\n        }\r\n        window.gi = {};\r\n        g.call(window.gi);\r\n    }\r\n\r\n    function changeDifficulty(difficulty) {\r\n        document.querySelector(\"li.checked[data-action=change-difficulty]\").classList.remove(\"checked\");\r\n        document.querySelector(`li[data-action=\"change-difficulty\"][data-difficulty=\"${difficulty}\"]`).classList.add(\"checked\");\r\n        window.globalOptions.difficulty = difficulty;\r\n        newGame();\r\n    }\r\n\r\n    function toggleMarks() {\r\n        window.globalOptions.marks = !window.globalOptions.marks;\r\n\r\n        document.querySelector(\"li[data-action=toggle-marks]\").classList.toggle(\"checked\");\r\n    }\r\n\r\n    newGame();\r\n\r\n    document.getElementById(\"face-button\").addEventListener(\"click\", function() {\r\n        newGame();\r\n    });\r\n\r\n    Array.from(document.querySelectorAll(\"#menubar > li\")).forEach(li => {\r\n        li.addEventListener(\"click\", function() {\r\n            if (li.classList.contains(\"open\")) {\r\n                li.classList.remove(\"open\");\r\n            } else {\r\n                Array.from(document.querySelectorAll(\"#menubar > li.open\")).forEach(l => {\r\n                    l.classList.remove(\"open\");\r\n                });\r\n                li.classList.add(\"open\");\r\n            }\r\n        });\r\n    });\r\n\r\n    document.querySelector(\"#menubar\").addEventListener(\"click\", function(event) {\r\n        if (!event.target.dataset.action) { return; }\r\n        switch (event.target.dataset.action) {\r\n            case \"new-game\":\r\n                newGame();\r\n            break;\r\n            case \"change-difficulty\":\r\n                changeDifficulty(event.target.dataset.difficulty);\r\n            break;\r\n            case \"toggle-marks\":\r\n                toggleMarks();\r\n            break;\r\n        }\r\n    });\r\n\r\n    if (window.globalOptions.marks) {\r\n        document.querySelector(\"li[data-action=toggle-marks]\").classList.add(\"checked\");\r\n    }\r\n\r\n    document.querySelector(`li[data-action=\"change-difficulty\"][data-difficulty=\"${window.globalOptions.difficulty}\"]`).classList.add(\"checked\");\r\n});"]}